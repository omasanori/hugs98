.TH HUGS-PACKAGE 1 "September 2003" "" ""
.SH NAME
hugs-package \- converting a source package for use with Hugs 98
.SH SYNOPSIS
.B hugs-package
.I pkg-dir
[
.I target-dir
]
.SH DESCRIPTION
Though Hugs does not uses packages directly, source packages that
work with the compilers may be converted for use with Hugs using the
.I hugs-package
script.
The \fIpkg-dir\fP directory should contain a collection of Haskell modules
and related files (see below).
The converted files are placed in a hierarchy under the directory
.IR target-dir .
You then need to ensure that this directory is in the path used by
.IR hugs (1).
If \fItarget-dir\fP, the converted package is placed in the
.B libraries
directory used by
.IR hugs (1),
if possible.
.SS "Package directory structure"
.PP
A package directory is assumed to contain a directory hierarchy
reflecting the module hierarchy, e.g. with module
.IB A . B . C
in the source file
.IB pkg-dir / A / B / C .hs
and so on.  The following filename suffixes are recognized:
.TP
.BR \fB.hs " or " .lhs
Haskell source, to be sent through the C preprocessor with
.B __HUGS__
defined.  The file may also \fB#include\fP
.BR HsFFi.h ,
.BR config.h ,
.B MachDeps.h
and any header files in \fIpkg-dir\fP\fB/include\fP.
.TP
.BR .y " or " .ly
Happy source, to be processed with
.IR happy (1)
with the result sent through the C preprocessor as above.
.TP
.B .hsc
input for
.IR hsc2hs (1)
and then the C preprocessor.
If \fIname\fP\fB_hsc_make.c\fP
(the platform-independent output of \fBhsc2hs --no-compile\fP)
is present, it will be used instead.
.TP
.B .gc
input for
.IR greencard (1).
.PP
In addition to Haskell source modules, the package directory may
optionally contain the following:
.TP
.B cbits/
a directory containing C source files to be linked with Haskell
files by ffihugs.
.TP
.B include/
a directory of C header files used by foreign declarations and
files in cbits.
.TP
.B hugs/exclude
a list of names of modules to be skipped by the conversion script.
(Only the first word in each line is used, and blank lines and
lines starting with \fB#\fP are ignored, leaving room for explanations.)
.TP
.B package.conf.in
a package configuration file, to be preprocessed with cpp.
The script uses the \fBextra_libraries\fP and \fBextra_ld_opts fields\fP.
.TP
.B package.conf
a package configuration file (not to be preprocessed).
.PP
The conversion script runs
.IR ffihugs (1)
where required.
It sets the include path, and also adds auxiliary files generated by
.IR hsc2hs (1)
and
.IR greencard (1).
C files from the \fBcbits\fP directory required by a module may be specified
with a \fBCBITS\fI `pragma' in the source file, for example:
.RS
.B "{-# CBITS file.c another.c #-}"
.RE
.SH ENVIRONMENT
.TP
.B HUGSDIR
The
.IR hugs (1)
library directory
.PP
Other environment variables that may be set are
.BR CC ,
.BR cpp ,
.BR hsc2hs ,
.BR greencard ,
.B ffihugs
and
.BR runhugs ,
all naming programs.
.SH "SEE ALSO"
.IR hugs (1),
.IR happy (1),
.IR hsc2hs (1),
.IR greencard (1)
.SH BUGS
The conversion process is somewhat brittle.
.PP
The program fails to follow dependencies in package configuration files.
